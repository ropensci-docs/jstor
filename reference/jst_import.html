<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function applies an import function to a list of xml-files
or a .zip-archive in case of jst_import_zip and saves
the output in batches of .csv-files to disk."><title>Wrapper for file import — jst_import • jstor</title><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wrapper for file import — jst_import"><meta property="og:description" content="This function applies an import function to a list of xml-files
or a .zip-archive in case of jst_import_zip and saves
the output in batches of .csv-files to disk."><meta property="og:image" content="https://docs.ropensci.org/jstor/logo.png"><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">jstor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/automating-file-import.html">Automating File Import</a>
    <a class="dropdown-item" href="../articles/known-quirks.html">Known Data Quirks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/analysing-n-grams.html">Case Study - Analysing Ngrams</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tklebel/jstor">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Wrapper for file import</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/jstor/blob/HEAD/R/batch_import_fun.R" class="external-link"><code>R/batch_import_fun.R</code></a></small>
      <div class="d-none name"><code>jst_import.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function applies an import function to a list of <code>xml</code>-files
or a .zip-archive in case of <code>jst_import_zip</code> and saves
the output in batches of <code>.csv</code>-files to disk.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">jst_import</span><span class="op">(</span></span>
<span>  <span class="va">in_paths</span>,</span>
<span>  <span class="va">out_file</span>,</span>
<span>  out_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">.f</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_batches <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  files_per_batch <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">jst_import_zip</span><span class="op">(</span></span>
<span>  <span class="va">zip_archive</span>,</span>
<span>  <span class="va">import_spec</span>,</span>
<span>  <span class="va">out_file</span>,</span>
<span>  out_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_batches <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  files_per_batch <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rows <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>in_paths</dt>
<dd><p>A character vector to the <code>xml</code>-files which should be
imported</p></dd>


<dt>out_file</dt>
<dd><p>Name of files to export to. Each batch gets appended by an
increasing number.</p></dd>


<dt>out_path</dt>
<dd><p>Path to export files to (combined with filename).</p></dd>


<dt>.f</dt>
<dd><p>Function to use for import. Can be one of <code>jst_get_article</code>,
<code>jst_get_authors</code>, <code>jst_get_references</code>, <code>jst_get_footnotes</code>, <code>jst_get_book</code>
or <code>jst_get_chapter</code>.</p></dd>


<dt>col_names</dt>
<dd><p>Should column names be written to file? Defaults to <code>TRUE</code>.</p></dd>


<dt>n_batches</dt>
<dd><p>Number of batches, defaults to 1.</p></dd>


<dt>files_per_batch</dt>
<dd><p>Number of files for each batch. Can be used instead of
n_batches, but not in conjunction.</p></dd>


<dt>show_progress</dt>
<dd><p>Displays a progress bar for each batch, if the session
is interactive.</p></dd>


<dt>zip_archive</dt>
<dd><p>A path to a .zip-archive from DfR</p></dd>


<dt>import_spec</dt>
<dd><p>A specification from <a href="jst_define_import.html">jst_define_import</a>
for which parts of a .zip-archive should be imported via which functions.</p></dd>


<dt>rows</dt>
<dd><p>Mainly used for testing, to decrease the number of files which
are imported (i.e. 1:100).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Writes <code>.csv</code>-files to disk.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Along the way, we wrap three functions, which make the process of converting
many files easier:</p><ul><li><p><code><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">purrr::safely()</a></code></p></li>
<li><p><code><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">furrr::future_map()</a></code></p></li>
<li><p><code><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">readr::write_csv()</a></code></p></li>
</ul><p>When using one of the <code>find_*</code> functions, there should usually be no errors.
To avoid the whole computation to fail in the unlikely event that an error
occurs, we use <code>safely()</code> which let's us
continue the process, and catch the error along the way.</p>
<p>If you have many files to import, you might benefit from executing the
function in parallel. We use futures for this to give you maximum
flexibility. By default the code is executed sequentially. If you want to
run it in parallel, simply call <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> with
<code><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession()</a></code> as an argument before
running <code>jst_import</code> or <code>jst_import_zip</code>.</p>
<p>After importing all files, they are written to disk with
<code><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">readr::write_csv()</a></code>.</p>
<p>Since you might run out of memory when importing a large quantity of files,
you can split up the files to import  into batches. Each batch is being
treated separately, therefore for each batch multiple processes from
<code><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession()</a></code> are spawned, if you added this plan.
For this reason, it is not recommended to have very small batches,
as there is an overhead for starting and ending the processes. On the other
hand, the batches should not be too large, to not exceed memory limitations.
A value of 10000 to 20000 for <code>files_per_batch</code> should work fine on most
machines. If the session is interactive and <code>show_progress</code> is <code>TRUE</code>, a
progress bar is displayed for each batch.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="jst_combine_outputs.html">jst_combine_outputs()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># read from file list --------</span></span></span>
<span class="r-in"><span><span class="co"># find all files</span></span></span>
<span class="r-in"><span><span class="va">meta_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"xml"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># import them via `jst_get_article`</span></span></span>
<span class="r-in"><span><span class="fu">jst_import</span><span class="op">(</span><span class="va">meta_files</span>, out_file <span class="op">=</span> <span class="st">"imported_metadata"</span>, .f <span class="op">=</span> <span class="va">jst_get_article</span>,</span></span>
<span class="r-in"><span>           files_per_batch <span class="op">=</span> <span class="fl">25000</span><span class="op">)</span></span></span>
<span class="r-in"><span>           </span></span>
<span class="r-in"><span><span class="co"># do the same, but in parallel</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multiprocess</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">jst_import</span><span class="op">(</span><span class="va">meta_files</span>, out_file <span class="op">=</span> <span class="st">"imported_metadata"</span>, .f <span class="op">=</span> <span class="va">jst_get_article</span>,</span></span>
<span class="r-in"><span>           files_per_batch <span class="op">=</span> <span class="fl">25000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># read from zip archive ------ </span></span></span>
<span class="r-in"><span><span class="co"># define imports</span></span></span>
<span class="r-in"><span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="jst_define_import.html">jst_define_import</a></span><span class="op">(</span>article <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jst_get_article</span>, <span class="va">jst_get_authors</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert the files to .csv</span></span></span>
<span class="r-in"><span><span class="fu">jst_import_zip</span><span class="op">(</span><span class="st">"my_archive.zip"</span>, out_file <span class="op">=</span> <span class="st">"my_out_file"</span>, </span></span>
<span class="r-in"><span>                 import_spec <span class="op">=</span> <span class="va">imports</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>

  

  

  </body></html>

