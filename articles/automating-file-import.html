<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="jstor">
<title>Automating File Import â€¢ jstor</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automating File Import">
<meta property="og:description" content="jstor">
<meta property="og:image" content="https://docs.ropensci.org/jstor/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">jstor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/automating-file-import.html">Automating File Import</a>
    <a class="dropdown-item" href="../articles/known-quirks.html">Known Data Quirks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/analysing-n-grams.html">Case Study - Analysing Ngrams</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tklebel/jstor">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Automating File Import</h1>
                        <h4 data-toc-skip class="author">Thomas Klebel</h4>
            
            <h4 data-toc-skip class="date">2024-03-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/jstor/blob/HEAD/vignettes/automating-file-import.Rmd" class="external-link"><code>vignettes/automating-file-import.Rmd</code></a></small>
      <div class="d-none name"><code>automating-file-import.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/jstor">jstor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>The <code>find_*</code> functions from <code>jstor</code> all work on a single file. Data from DfR however contains many single files, from up to 25,000 when using the self-service functions, up to several hundreds of thousands of files when requesting a large dataset via an agreement.</p>
<p>Currently <code>jstor</code> offers two implementations to import many files: <code><a href="../reference/jst_import.html">jst_import_zip()</a></code> and <code><a href="../reference/jst_import.html">jst_import()</a></code>. The first one lets you import data directly from zip archives, the second works for file paths, so you need to unzip the archive first. I will first introduce <code><a href="../reference/jst_import.html">jst_import_zip()</a></code> and discuss the approach of with <code><a href="../reference/jst_import.html">jst_import()</a></code> afterwards.</p>
</div>
<div class="section level2">
<h2 id="importing-data-directly-from-zip-archives">Importing data directly from zip-archives<a class="anchor" aria-label="anchor" href="#importing-data-directly-from-zip-archives"></a>
</h2>
<p>Unpacking and working with many files directly is unpractical for at least three reasons:</p>
<ol style="list-style-type: decimal">
<li>If you unzip the archive, the single files will occupy a lot more disk space than the single archive.</li>
<li>Before you can import the files, you need to list them via <code>list.files</code> or <code>system("find...")</code> on UNIX. Depending on the size of your data, this can take some time.</li>
<li>There might be different types of data in your sample (journal articles, book chapters, etc.). You need to manage matching the paths to the appropriate functions, which is extra work.</li>
</ol>
<p>Importing directly from the zip archive simplifies all those tasks with a single function: <code><a href="../reference/jst_import.html">jst_import_zip()</a></code>. For the following demonstration, we will use a small sample archive that comes with the package.</p>
<p>As a first step, we should take a look at the archive and its content. This is made easy with <code><a href="../reference/jst_preview_zip.html">jst_preview_zip()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jst_preview_zip.html">jst_preview_zip</a></span><span class="op">(</span><span class="fu"><a href="../reference/jst_example.html">jst_example</a></span><span class="op">(</span><span class="st">"pseudo_dfr.zip"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">type</th>
<th align="left">meta_type</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">metadata</td>
<td align="left">book_chapter</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">metadata</td>
<td align="left">journal_article</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">metadata</td>
<td align="left">pamphlet</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ngram1</td>
<td align="left">ngram1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>We can see that we have a simple archive with three metadata files and one ngram file. Before we can use <code><a href="../reference/jst_import.html">jst_import_zip()</a></code>, we first need to think about, what we actually want to import: all of the data, or just parts? What kind of data do we want to extract from articles, books and pamphlets? We can specify this via <code><a href="../reference/jst_define_import.html">jst_define_import()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">import_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jst_define_import.html">jst_define_import</a></span><span class="op">(</span></span>
<span>  article <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jst_get_article</span>, <span class="va">jst_get_authors</span><span class="op">)</span>,</span>
<span>  book <span class="op">=</span> <span class="va">jst_get_book</span>,</span>
<span>  ngram1 <span class="op">=</span> <span class="va">jst_get_ngram</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this case, we want to import data on articles (standard metadata plus information on the authors), general data on books and unigrams (ngram1). This specification can then be used with <code><a href="../reference/jst_import.html">jst_import_zip()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up a temporary folder for output files</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract the content and write output to disk</span></span>
<span><span class="fu"><a href="../reference/jst_import.html">jst_import_zip</a></span><span class="op">(</span><span class="fu"><a href="../reference/jst_example.html">jst_example</a></span><span class="op">(</span><span class="st">"pseudo_dfr.zip"</span><span class="op">)</span>,</span>
<span>               import_spec <span class="op">=</span> <span class="va">import_spec</span>,</span>
<span>               out_file <span class="op">=</span> <span class="st">"my_test"</span>,</span>
<span>               out_path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing files for <span style="color: #00BB00;">book_chapter</span> with functions <span style="color: #0000BB;">jst_get_book</span></span></span>
<span><span class="co">#&gt; Processing files for <span style="color: #00BB00;">journal_article</span> with functions <span style="color: #0000BB;">jst_get_article, jst_get_authors</span></span></span>
<span><span class="co">#&gt; Processing files for <span style="color: #00BB00;">ngram1</span> with functions <span style="color: #0000BB;">jst_get_ngram</span></span></span></code></pre></div>
<p>We can take a look at the files within <code>tmp</code> with <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tmp</span>, pattern <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "my_test_book_chapter_jst_get_book-1.csv"      </span></span>
<span><span class="co">#&gt; [2] "my_test_journal_article_jst_get_article-1.csv"</span></span>
<span><span class="co">#&gt; [3] "my_test_journal_article_jst_get_authors-1.csv"</span></span>
<span><span class="co">#&gt; [4] "my_test_ngram1_jst_get_ngram-1.csv"</span></span></code></pre></div>
<p>As you can see, <code><a href="../reference/jst_import.html">jst_import_zip()</a></code> automatically creates file names based on the string you supplied to <code>out_file</code> to delineate the different types of output.</p>
<p>If we want to re-import the data for further analysis, we can either use functions like <code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv()</a></code>, or a small helper function from the package which determines and sets the column types correctly:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jst_re_import.html">jst_re_import</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"my_test_journal_article_jst_get_article-1.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="11%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="11%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">file_name</th>
<th align="left">journal_doi</th>
<th align="left">journal_jcode</th>
<th align="left">journal_pub_id</th>
<th align="left">journal_title</th>
<th align="left">article_doi</th>
<th align="left">article_pub_id</th>
<th align="left">article_jcode</th>
<th align="left">article_type</th>
<th align="left">article_title</th>
<th align="left">volume</th>
<th align="left">issue</th>
<th align="left">language</th>
<th align="left">pub_day</th>
<th align="left">pub_month</th>
<th align="right">pub_year</th>
<th align="left">first_page</th>
<th align="left">last_page</th>
<th align="left">page_range</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">journal-article-standard_case</td>
<td align="left">NA</td>
<td align="left">kewbulletin</td>
<td align="left">NA</td>
<td align="left">Kew Bulletin</td>
<td align="left">10.2307/4117222</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">research-article</td>
<td align="left">Two New Species of Ischaemum</td>
<td align="left">5</td>
<td align="left">2</td>
<td align="left">eng</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="right">1950</td>
<td align="left">187</td>
<td align="left">188</td>
<td align="left">187-188</td>
</tr></tbody>
</table>
<p>A side note on ngrams: For larger archives, importing all ngrams can take a very long time. It is thus advisable to only import ngrams for articles which you want to analyse, i.e.Â most likely a subset of the initial request. The function <code><a href="../reference/jst_subset_ngrams.html">jst_subset_ngrams()</a></code> helps you with this (see also the section on importing bigrams in the <a href="https://docs.ropensci.org/jstor/articles/analysing-n-grams.html#importing-bigrams">case study</a>).</p>
<div class="section level3">
<h3 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p>Since the above process might take a while for larger archives (files have to be unpacked, read and parsed), there might be a benefit of executing the function in parallel. <code><a href="../reference/jst_import.html">jst_import_zip()</a></code> and <code><a href="../reference/jst_import.html">jst_import()</a></code> use <code>furrr</code> at their core, therefore adding parallelism is very easy. Just add the following lines at the beginning of your script, and the import will use all available cores:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></code></pre></div>
<p>You can find out more about futures by reading the package vignette:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"future-1-overview"</span>, package <span class="op">=</span> <span class="st">"future"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-file-paths">Working with file paths<a class="anchor" aria-label="anchor" href="#working-with-file-paths"></a>
</h2>
<p>The above approach of importing directly from zip archives is very convenient, but in some cases you might want to have more control over how data is imported. For example, if you run into problems because the output from any of the functions provided with the package looks corrupted, you could want to look at the original files. Alongside this, you could unzip the archive and work with the files directly, which I will demonstrate in the following sections.</p>
<div class="section level3">
<h3 id="unzip-containers">Unzip containers<a class="anchor" aria-label="anchor" href="#unzip-containers"></a>
</h3>
<p>For simple purposes it might be sensible to unzip to a temporary directory (with <code>temp()</code> and <code><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip()</a></code>) but for my research I simply extracted files to an external SSD, since I a) lacked disk space, b) needed to read them fast, and c) wanted to be able to look at specific files for debugging.</p>
</div>
<div class="section level3">
<h3 id="list-files">List files<a class="anchor" aria-label="anchor" href="#list-files"></a>
</h3>
<p>There are many ways to generate a list of all files: <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files()</a></code> or using <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code> in conjunction with <code>find</code> on unix-like systems are common options.</p>
<p>For demonstration purposes I use files contained in <code>jstor</code> which can be accessed via <code>system.file</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"jstor"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="list-files-1">
<code>list.files</code><a class="anchor" aria-label="anchor" href="#list-files-1"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_names_listed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">example_dir</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                pattern <span class="op">=</span> <span class="st">"*.xml"</span><span class="op">)</span></span>
<span><span class="va">file_names_listed</span></span>
<span><span class="co">#&gt; [1] "/usr/local/lib/R/site-library/jstor/extdata/article_with_footnotes.xml" </span></span>
<span><span class="co">#&gt; [2] "/usr/local/lib/R/site-library/jstor/extdata/article_with_references.xml"</span></span>
<span><span class="co">#&gt; [3] "/usr/local/lib/R/site-library/jstor/extdata/book.xml"                   </span></span>
<span><span class="co">#&gt; [4] "/usr/local/lib/R/site-library/jstor/extdata/parsed_references.xml"</span></span></code></pre></div>
<div class="section level4">
<h4 id="system-and-find">
<code>system</code> and <code>find</code><a class="anchor" aria-label="anchor" href="#system-and-find"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cd "</span>, <span class="va">example_dir</span>, <span class="st">"; find . -name '*.xml' -type f"</span><span class="op">)</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">file_names_system</span> <span class="op">&lt;-</span> <span class="va">file_names</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="st">"^\\.\\/"</span>, <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="va">example_dir</span>, <span class="st">"/"</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">file_names_system</span></span>
<span><span class="co">#&gt; [1] "/Library/Frameworks/R.framework/Versions/3.4/Resources/library/jstor/extdata/sample_with_footnotes.xml" </span></span>
<span><span class="co">#&gt; [2] "/Library/Frameworks/R.framework/Versions/3.4/Resources/library/jstor/extdata/sample_book.xml"</span></span>
<span><span class="co">#&gt; [3] "/Library/Frameworks/R.framework/Versions/3.4/Resources/library/jstor/extdata/sample_with_references.xml"</span></span></code></pre></div>
<p>In this case the two approaches give the same result. The main difference seems to be though, that <code>list.files</code> sorts the output, whereas <code>find</code> does not. For a large amount of files (200,000) this makes <code>list.files</code> slower, for smaller datasets the difference shouldnâ€™t make an impact.</p>
</div>
</div>
<div class="section level3">
<h3 id="batch-import">Batch import<a class="anchor" aria-label="anchor" href="#batch-import"></a>
</h3>
<p>Once the file list is generated, we can apply any of the <code>jst_get_*</code>-functions to the list. A good and simple way for small to moderate amounts of files is to use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">purrr::map_df()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only work with journal articles</span></span>
<span><span class="va">article_paths</span> <span class="op">&lt;-</span> <span class="va">file_names_listed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">str_detect</span>, <span class="st">"with"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">article_paths</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">jst_get_article</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="17%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="11%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">file_name</th>
<th align="left">journal_doi</th>
<th align="left">journal_jcode</th>
<th align="left">journal_pub_id</th>
<th align="left">journal_title</th>
<th align="left">article_doi</th>
<th align="left">article_pub_id</th>
<th align="left">article_jcode</th>
<th align="left">article_type</th>
<th align="left">article_title</th>
<th align="left">volume</th>
<th align="left">issue</th>
<th align="left">language</th>
<th align="left">pub_day</th>
<th align="left">pub_month</th>
<th align="right">pub_year</th>
<th align="left">first_page</th>
<th align="left">last_page</th>
<th align="left">page_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">article_with_footnotes</td>
<td align="left">NA</td>
<td align="left">washhistq</td>
<td align="left">NA</td>
<td align="left">The Washington Historical Quarterly</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">40428382</td>
<td align="left">research-article</td>
<td align="left">The Nisqually Journal (Continued)</td>
<td align="left">13</td>
<td align="left">2</td>
<td align="left">eng</td>
<td align="left">1</td>
<td align="left">4</td>
<td align="right">1922</td>
<td align="left">131</td>
<td align="left">141</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">article_with_references</td>
<td align="left">NA</td>
<td align="left">tranamermicrsoci</td>
<td align="left">NA</td>
<td align="left">Transactions of the American Microscopical Society</td>
<td align="left">10.2307/3221896</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">research-article</td>
<td align="left">On the Protozoa Parasitic in Frogs</td>
<td align="left">41</td>
<td align="left">2</td>
<td align="left">eng</td>
<td align="left">1</td>
<td align="left">4</td>
<td align="right">1922</td>
<td align="left">59</td>
<td align="left">76</td>
<td align="left">59-76</td>
</tr>
</tbody>
</table>
<p>This works well if 1) there are no errors and 2) if there is only a moderate size of files. For larger numbers of files, <code><a href="../reference/jst_import.html">jst_import()</a></code> can streamline the process for you. This function works very similar to <code><a href="../reference/jst_import.html">jst_import_zip()</a></code>, the main difference being that it needs file paths as input and can only handle one type of output.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jst_import.html">jst_import</a></span><span class="op">(</span><span class="va">article_paths</span>, out_file <span class="op">=</span> <span class="st">"my_second_test"</span>, .f <span class="op">=</span> <span class="va">jst_get_article</span>, </span>
<span>           out_path <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting to import 2 file(s).</span></span>
<span><span class="co">#&gt; Finished importing 2 file(s) in 0.03 secs.</span></span></code></pre></div>
<p>The result is again written to disk, as can be seen below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tmp</span>, pattern <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "my_second_test-1.csv"                         </span></span>
<span><span class="co">#&gt; [2] "my_test_book_chapter_jst_get_book-1.csv"      </span></span>
<span><span class="co">#&gt; [3] "my_test_journal_article_jst_get_article-1.csv"</span></span>
<span><span class="co">#&gt; [4] "my_test_journal_article_jst_get_authors-1.csv"</span></span>
<span><span class="co">#&gt; [5] "my_test_ngram1_jst_get_ngram-1.csv"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
